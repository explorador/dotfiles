#!/bin/sh

# Clear screen
clear

# Run files.
# ----------------------------------------------------------------
sh ~/.dotfiles/baseline/.macos
sh ~/.dotfiles/baseline/.brew
sh ~/.dotfiles/baseline/.apps_settings


# Create "install" directory
# (Used to download and save apps not available in the appstore or brew)
mkdir install


# NVM
# ----------------------------------------------------------------
# Install
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.37.0/install.sh | bash


# Get email.
email=$(defaults read com.apple.iTunes MacBuddyStoreID)
# Signin into 1password
eval $(op signin my.1password.com $email)


# Chezmoi (Dotfile manager).
# ----------------------------------------------------------------
mkdir ~/.config/chezmoi
# Copy default config file from repo
cp ~/.dotfiles/config/chezmoi.json ~/.config/chezmoi
# Pull dot files
chezmoi update


# Countdown
countdown() {
	secs=$1
	shift
	msg=$@
	while [ $secs -gt 0 ]
	do
		printf "\r\033[K$msg %.d seconds" $((secs--))
		sleep 1
	done
	echo
}

# Display reminder.
osascript -e 'tell app "System Events" to display dialog "⚠️ Remember to setup Dropbox and Alfred"'

# Execute countdown
countdown 10 "Rebooting in"

# Reboot.
reboot
